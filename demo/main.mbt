// MoonLog ä½¿ç”¨ç¤ºä¾‹
// æ¼”ç¤ºå…¨å±€æ—¥å¿—æ¥å£çš„å„ç§ç”¨æ³•

fn init {
  println("ğŸŒ™ MoonLog Demo - å…¨å±€æ—¥å¿—æ¥å£æ¼”ç¤º")
  println("==================================================")
}

fn main {
  // === 1. åŸºç¡€å…¨å±€æ—¥å¿—å‡½æ•°æ¼”ç¤º ===
  println("\nğŸ“ 1. åŸºç¡€å…¨å±€æ—¥å¿—å‡½æ•°æ¼”ç¤º")
  
  // ç›´æ¥ä½¿ç”¨å…¨å±€æ—¥å¿—å‡½æ•° - æœ€ç®€å•çš„æ–¹å¼
  @moonlog.info("åº”ç”¨å¯åŠ¨æˆåŠŸ")
  @moonlog.warn("è¿™æ˜¯ä¸€ä¸ªè­¦å‘Šä¿¡æ¯")  
  @moonlog.error("æ¨¡æ‹Ÿé”™è¯¯ä¿¡æ¯")
  @moonlog.debug("è°ƒè¯•ä¿¡æ¯ï¼ˆå¯èƒ½ä¸æ˜¾ç¤ºï¼Œå–å†³äºæ—¥å¿—çº§åˆ«ï¼‰")
  
  // === 2. ç»“æ„åŒ–æ—¥å¿—æ¼”ç¤º ===
  println("\nğŸ—ï¸ 2. ç»“æ„åŒ–æ—¥å¿—æ¼”ç¤º")
  
  @moonlog.info_with_fields("ç”¨æˆ·ç™»å½•", [
    @moonlog.field_str("user", "alice"),
    @moonlog.field_str("ip", "192.168.1.100"),
    @moonlog.field_int("user_id", 12345)
  ])
  
  @moonlog.warn_with_fields("APIè¯·æ±‚è¶…æ—¶", [
    @moonlog.field_str("endpoint", "/api/users"),
    @moonlog.field_int("timeout_ms", 5000),
    @moonlog.field_bool("retry", true)
  ])
  
  // === 3. å®é™…åº”ç”¨åœºæ™¯æ¼”ç¤º ===
  println("\nğŸš€ 3. å®é™…åº”ç”¨åœºæ™¯æ¼”ç¤º")
  
  // æ¨¡æ‹ŸWebæœåŠ¡å™¨å¯åŠ¨
  simulate_web_server_startup()
  
  // æ¨¡æ‹Ÿå¤„ç†HTTPè¯·æ±‚
  simulate_http_request_handling()
  
  // æ¨¡æ‹Ÿé”™è¯¯å¤„ç†
  simulate_error_handling()
  
  println("\nâœ… Demoæ¼”ç¤ºå®Œæˆï¼")
  println("\nğŸ’¡ æç¤ºï¼šå½“å‰ä½¿ç”¨çš„æ˜¯é»˜è®¤é…ç½®")
  println("   - å¦‚éœ€è‡ªå®šä¹‰Loggerå®ä¾‹ï¼Œè¯·å‚è€ƒAPIæ–‡æ¡£")
  println("   - æ”¯æŒåŠ¨æ€é…ç½®æ—¥å¿—çº§åˆ«å’ŒAppender")
  println("   - æ”¯æŒæ¨¡å—åŒ–çš„Loggerç®¡ç†")
  
  // æ˜¾ç¤ºé«˜çº§é…ç½®ç¤ºä¾‹
  advanced_demo()
}

// æ¨¡æ‹ŸWebæœåŠ¡å™¨å¯åŠ¨è¿‡ç¨‹
fn simulate_web_server_startup() -> Unit {
  @moonlog.info("æ­£åœ¨å¯åŠ¨WebæœåŠ¡å™¨...")
  
  @moonlog.debug_with_fields("åŠ è½½é…ç½®æ–‡ä»¶", [
    @moonlog.field_str("config_file", "/etc/app/config.json"),
    @moonlog.field_bool("found", true)
  ])
  
  @moonlog.info_with_fields("æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ", [
    @moonlog.field_str("host", "0.0.0.0"),
    @moonlog.field_int("port", 8080),
    @moonlog.field_str("version", "1.0.0")
  ])
}

// æ¨¡æ‹ŸHTTPè¯·æ±‚å¤„ç†
fn simulate_http_request_handling() -> Unit {
  @moonlog.info_with_fields("æ”¶åˆ°HTTPè¯·æ±‚", [
    @moonlog.field_str("method", "GET"),
    @moonlog.field_str("path", "/api/users/123"),
    @moonlog.field_str("user_agent", "curl/7.68.0")
  ])
  
  @moonlog.debug_with_fields("æŸ¥è¯¢æ•°æ®åº“", [
    @moonlog.field_str("table", "users"),
    @moonlog.field_int("user_id", 123)
  ])
  
  @moonlog.info_with_fields("è¯·æ±‚å¤„ç†å®Œæˆ", [
    @moonlog.field_int("status_code", 200),
    @moonlog.field_int("response_time_ms", 45)
  ])
}

// æ¨¡æ‹Ÿé”™è¯¯å¤„ç†
fn simulate_error_handling() -> Unit {
  @moonlog.error_with_fields("æ•°æ®åº“è¿æ¥å¤±è´¥", [
    @moonlog.field_str("host", "db.example.com"),
    @moonlog.field_int("port", 5432),
    @moonlog.field_str("error", "connection timeout")
  ])
  
  @moonlog.warn("å¯ç”¨é™çº§æ¨¡å¼")
  
  @moonlog.fatal_with_fields("ç³»ç»Ÿå…³é”®é”™è¯¯", [
    @moonlog.field_str("component", "payment_service"),
    @moonlog.field_str("error_code", "PAYMENT_001"),
    @moonlog.field_bool("auto_recovery", false)
  ])
} 
