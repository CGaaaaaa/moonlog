// åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹
//
// è¿™ä¸ªæ–‡ä»¶å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨moonlogæ—¥å¿—åº“çš„å„ç§åŠŸèƒ½

// å¯¼å…¥å¿…è¦çš„æ—¥å¿—æ¨¡å—
// import moonlog/global
// import moonlog/logger
// import moonlog/types

// ç¤ºä¾‹1: åŸºæœ¬çš„å…¨å±€æ—¥å¿—è®°å½•
fn example_basic_global_logging() -> Unit {
  println("=== åŸºæœ¬å…¨å±€æ—¥å¿—è®°å½•ç¤ºä¾‹ ===")
  
  // ç›´æ¥ä½¿ç”¨å…¨å±€æ—¥å¿—æ–¹æ³•
  info_msg("åº”ç”¨ç¨‹åºå·²å¯åŠ¨")
  warn_msg("è¿™æ˜¯ä¸€ä¸ªè­¦å‘Šæ¶ˆæ¯")
  error_msg("å‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯")
  
  // å¸¦å­—æ®µçš„ç»“æ„åŒ–æ—¥å¿—
  let user_fields = [
    field_str("user_id", "12345"),
    field_str("username", "alice"),
    field_int("age", 25)
  ]
  info("ç”¨æˆ·ç™»å½•", user_fields)
  
  // æ ¼å¼åŒ–æ—¥å¿—
  infof("ç”¨æˆ· {} åœ¨ {} ç™»å½•", ["alice", "2023-12-28"])
}

// ç¤ºä¾‹2: é…ç½®å…¨å±€Logger
fn example_configure_global_logger() -> Unit {
  println("\n=== é…ç½®å…¨å±€Loggerç¤ºä¾‹ ===")
  
  // é…ç½®æ§åˆ¶å°Logger
  configure_console_logger(
    LogLevel::Debug,
    true, 
    true,
    true
  )
  
  debug_msg("è¿™æ˜¯ä¸€æ¡è°ƒè¯•æ¶ˆæ¯")
  info_msg("é…ç½®å®Œæˆ")
  
  // é…ç½®æ–‡ä»¶Logger
  configure_file_logger(
    LogLevel::Info,
    "logs/app.log",
    1024L * 1024L,  // 1MB
    5,
    false
  )
  
  info_msg("æ–‡ä»¶æ—¥å¿—é…ç½®å®Œæˆ")
}

// ç¤ºä¾‹3: åˆ›å»ºè‡ªå®šä¹‰Loggerå®ä¾‹
fn example_custom_logger() -> Unit {
  println("\n=== è‡ªå®šä¹‰Loggerå®ä¾‹ç¤ºä¾‹ ===")
  
  // åˆ›å»ºä¸€ä¸ªä¸“é—¨ç”¨äºæ•°æ®åº“æ“ä½œçš„Logger
  let db_logger = Logger::new(LogLevel::Debug, "database")
    .add_console_appender(
      ConsoleAppender::new(
        SimpleFormatter::new(true, true)
      )
    )
    .add_file_appender(
      FileAppender::new(
        "logs/database.log",
        SimpleFormatter::new(true, true),
        512L * 1024L,  // 512KB
        3
      )
    )
  
  // ä½¿ç”¨è‡ªå®šä¹‰Loggerï¼ˆé€šè¿‡åŸºæœ¬logæ–¹æ³•ï¼‰
  db_logger.log(LogLevel::Info, "æ•°æ®åº“è¿æ¥å·²å»ºç«‹", [
    field_str("host", "localhost"),
    field_int("port", 5432)
  ])
  
  db_logger.logf_with_fields(LogLevel::Debug, "æ‰§è¡ŒæŸ¥è¯¢: {}", ["SELECT * FROM users"], [])
  
  db_logger.log(LogLevel::Error, "æ•°æ®åº“è¿æ¥å¤±è´¥", [
    field_str("error", "connection timeout"),
    field_int("retry_count", 3)
  ])
}

// ç¤ºä¾‹4: ä¸åŒæ ¼å¼åŒ–å™¨çš„ä½¿ç”¨
fn example_different_formatters() -> Unit {
  println("\n=== ä¸åŒæ ¼å¼åŒ–å™¨ç¤ºä¾‹ ===")
  
  // JSONæ ¼å¼åŒ–å™¨
  let json_logger = Logger::new(LogLevel::Info, "json-module")
    .add_console_appender(
      ConsoleAppender::new(
        SimpleFormatter::new(true, true)
      )
    )
  
  json_logger.log(LogLevel::Info, "JSONæ ¼å¼çš„æ—¥å¿—", [
    field_str("event", "user_action"),
    field_str("action", "login"),
    field_bool("success", true)
  ])
  
  // å½©è‰²æ ¼å¼åŒ–å™¨æ¼”ç¤º
  println("\nå½©è‰²æ ¼å¼åŒ–å™¨æ¼”ç¤ºï¼š")
  debug_msg("è¿™æ˜¯è°ƒè¯•ä¿¡æ¯")
  info_msg("è¿™æ˜¯ä¿¡æ¯æ—¥å¿—") 
  warn_msg("è¿™æ˜¯è­¦å‘Šä¿¡æ¯")
  error_msg("è¿™æ˜¯é”™è¯¯ä¿¡æ¯")
}

// ç¤ºä¾‹5: å¤æ‚çš„ç»“æ„åŒ–æ—¥å¿—
fn example_structured_logging() -> Unit {
  println("\n=== ç»“æ„åŒ–æ—¥å¿—ç¤ºä¾‹ ===")
  
  // ç”¨æˆ·æ´»åŠ¨è·Ÿè¸ª
  let user_activity_fields = [
    field_str("user_id", "user_12345"),
    field_str("session_id", "sess_abcdef"),
    field_str("ip_address", "192.168.1.100"),
    field_str("user_agent", "Mozilla/5.0"),
    field_int("duration_ms", 1500)
  ]
  
  info("ç”¨æˆ·æ´»åŠ¨è®°å½•", user_activity_fields)
  
  // APIè¯·æ±‚æ—¥å¿—
  let api_request_fields = [
    field_str("method", "POST"),
    field_str("endpoint", "/api/v1/users"),
    field_int("status_code", 201),
    field_int("response_time_ms", 45),
    field_int("request_size", 1024),
    field_int("response_size", 256)
  ]
  
  info("APIè¯·æ±‚å¤„ç†", api_request_fields)
  
  // é”™è¯¯è¯¦æƒ…
  let error_fields = [
    field_str("error_type", "ValidationError"),
    field_str("error_code", "INVALID_EMAIL"),
    field_str("field_name", "email"),
    field_str("provided_value", "invalid-email"),
    field_str("stack_trace", "at validate_email:42")
  ]
  
  error("è¾“å…¥éªŒè¯å¤±è´¥", error_fields)
}

// ç¤ºä¾‹6: ä¸åŒçº§åˆ«çš„æ—¥å¿—å’Œè¿‡æ»¤
fn example_log_levels() -> Unit {
  println("\n=== æ—¥å¿—çº§åˆ«å’Œè¿‡æ»¤ç¤ºä¾‹ ===")
  
  // è®¾ç½®ä¸ºInfoçº§åˆ«ï¼ŒDebugå’ŒTraceå°†è¢«è¿‡æ»¤æ‰
  set_global_level(LogLevel::Info)
  
  trace_msg("è¿™æ¡traceæ—¥å¿—ä¸ä¼šæ˜¾ç¤º")
  debug_msg("è¿™æ¡debugæ—¥å¿—ä¸ä¼šæ˜¾ç¤º") 
  info_msg("è¿™æ¡infoæ—¥å¿—ä¼šæ˜¾ç¤º")
  warn_msg("è¿™æ¡warnæ—¥å¿—ä¼šæ˜¾ç¤º")
  error_msg("è¿™æ¡erroræ—¥å¿—ä¼šæ˜¾ç¤º")
  
  // æ”¹ä¸ºDebugçº§åˆ«
  set_global_level(LogLevel::Debug)
  println("\nåˆ‡æ¢åˆ°Debugçº§åˆ«:")
  
  debug_msg("ç°åœ¨debugæ—¥å¿—ä¼šæ˜¾ç¤ºäº†")
  trace_msg("ä½†traceæ—¥å¿—ä»ç„¶ä¸ä¼šæ˜¾ç¤º")
}

// ä¸»å‡½æ•°ï¼šè¿è¡Œæ‰€æœ‰ç¤ºä¾‹
pub fn run_examples() -> Unit {
  println("ğŸŒ™ MoonLog æ—¥å¿—åº“ä½¿ç”¨ç¤ºä¾‹")
  println("================================\n")
  
  example_basic_global_logging()
  example_configure_global_logger()
  example_custom_logger()
  example_different_formatters() 
  example_structured_logging()
  example_log_levels()
  
  println("\n================================")
  println("âœ… æ‰€æœ‰ç¤ºä¾‹è¿è¡Œå®Œæˆ!")
}