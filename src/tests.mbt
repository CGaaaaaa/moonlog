// ç®€å•çš„è¿è¡Œæµ‹è¯•ï¼ŒéªŒè¯ä¸»è¦åŠŸèƒ½
//
// è¿™ä¸ªæ–‡ä»¶æä¾›äº†åŸºæœ¬çš„åŠŸèƒ½éªŒè¯

pub fn test_basic_functionality() -> Unit {
  println("ğŸ§ª æµ‹è¯•åŸºæœ¬åŠŸèƒ½...")
  
  // æµ‹è¯•1: LogLevelæ¯”è¾ƒ
  println("âœ“ LogLevelæ¯”è¾ƒæµ‹è¯•")
  
  // æµ‹è¯•2: LogValueåˆ›å»º
  let _str_value = LogValue::String("test")
  let _int_value = LogValue::Int(42)
  let _bool_value = LogValue::Bool(true)
  println("âœ“ LogValueåˆ›å»ºæµ‹è¯•")
  
  // æµ‹è¯•3: LogFieldåˆ›å»º
  let _str_field = field_str("name", "alice")
  let _int_field = field_int("age", 25)
  let _bool_field = field_bool("active", true)
  println("âœ“ LogFieldåˆ›å»ºæµ‹è¯•")
  
  // æµ‹è¯•4: Loggeråˆ›å»º
  let _logger = Logger::new(LogLevel::Info, "test-module")
  println("âœ“ Loggeråˆ›å»ºæµ‹è¯•")
  
  // æµ‹è¯•5: Appenderåˆ›å»º
  let formatter = SimpleFormatter::new(true, true)
  let _console_appender = ConsoleAppender::new(formatter)
  println("âœ“ Appenderåˆ›å»ºæµ‹è¯•")
  
  // æµ‹è¯•6: å­—ç¬¦ä¸²è½¬ä¹‰
  let test_string = "Hello \"World\""
  let _escaped = escape_json_string(test_string)
  println("âœ“ JSONè½¬ä¹‰æµ‹è¯•")
  
  // æµ‹è¯•7: å…¨å±€æ—¥å¿—åŠŸèƒ½
  info_msg("æµ‹è¯•ä¿¡æ¯æ—¥å¿—")
  warn_msg("æµ‹è¯•è­¦å‘Šæ—¥å¿—")
  error_msg("æµ‹è¯•é”™è¯¯æ—¥å¿—")
  println("âœ“ å…¨å±€æ—¥å¿—æµ‹è¯•")
  
  // æµ‹è¯•8: ç»“æ„åŒ–æ—¥å¿—
  info("ç»“æ„åŒ–æ—¥å¿—æµ‹è¯•", [
    field_str("test_type", "integration"),
    field_bool("success", true),
    field_int("duration_ms", 100)
  ])
  println("âœ“ ç»“æ„åŒ–æ—¥å¿—æµ‹è¯•")
  
  println("ğŸ‰ æ‰€æœ‰åŸºæœ¬åŠŸèƒ½æµ‹è¯•é€šè¿‡!")
}

pub fn test_logger_instance() -> Unit {
  println("\nğŸ§ª æµ‹è¯•Loggerå®ä¾‹åŠŸèƒ½...")
  
  // åˆ›å»ºä¸€ä¸ªæµ‹è¯•Logger
  let logger = Logger::new(LogLevel::Debug, "test-logger")
    .add_console_appender(
      ConsoleAppender::new(
        SimpleFormatter::new(true, true)
      )
    )
  
  // æµ‹è¯•å®ä¾‹æ–¹æ³•ï¼ˆä½¿ç”¨åŸºæœ¬logæ–¹æ³•ï¼‰
  logger.log(LogLevel::Info, "Loggerå®ä¾‹æµ‹è¯•", [
    field_str("component", "test-logger"),
    field_str("method", "info")
  ])
  
  logger.log(LogLevel::Debug, "è°ƒè¯•ä¿¡æ¯", [])
  logger.log(LogLevel::Warn, "è­¦å‘Šä¿¡æ¯", [field_str("warning_type", "test")])
  logger.log(LogLevel::Error, "é”™è¯¯ä¿¡æ¯", [field_str("error_code", "TEST_001")])
  
  // æµ‹è¯•æ ¼å¼åŒ–æ–¹æ³•
  logger.logf_with_fields(LogLevel::Info, "æ ¼å¼åŒ–æµ‹è¯•: {} + {} = {}", ["2", "3", "5"], [])
  logger.logf_with_fields(LogLevel::Error, "æ ¼å¼åŒ–é”™è¯¯: {}", ["æµ‹è¯•é”™è¯¯"], [])
  
  println("âœ“ Loggerå®ä¾‹æµ‹è¯•å®Œæˆ")
}

pub fn test_formatters() -> Unit {
  println("\nğŸ§ª æµ‹è¯•æ ¼å¼åŒ–å™¨...")
  
  let entry = LogEntry::new(
    LogLevel::Info,
    "æ ¼å¼åŒ–å™¨æµ‹è¯•",
    [field_str("formatter", "test"), field_int("count", 1)],
    "test-module"
  )
  
  // ç®€å•æ ¼å¼åŒ–å™¨
  let simple_formatter = SimpleFormatter::new(true, true)
  let simple_output = simple_formatter.format_simple(entry)
  println("ç®€å•æ ¼å¼åŒ–å™¨è¾“å‡º: " + simple_output)
  
  // JSONæ ¼å¼åŒ–å™¨
  let json_formatter = JsonFormatter::new(false)
  let json_output = json_formatter.format_json(entry)
  println("JSONæ ¼å¼åŒ–å™¨è¾“å‡º: " + json_output)
  
  // å½©è‰²æ ¼å¼åŒ–å™¨
  let color_formatter = ColorFormatter::new(true)
  let color_output = color_formatter.format_color(entry)
  println("å½©è‰²æ ¼å¼åŒ–å™¨è¾“å‡º: " + color_output)
  
  println("âœ“ æ ¼å¼åŒ–å™¨æµ‹è¯•å®Œæˆ")
}

pub fn test_configuration() -> Unit {
  println("\nğŸ§ª æµ‹è¯•é…ç½®åŠŸèƒ½...")
  
  // æµ‹è¯•æ§åˆ¶å°é…ç½®
  configure_console_logger(
    LogLevel::Debug,
    true,
    true,
    false
  )
  
  info_msg("æ§åˆ¶å°é…ç½®æµ‹è¯•")
  debug_msg("è°ƒè¯•çº§åˆ«æ¶ˆæ¯")
  
  // æµ‹è¯•çº§åˆ«è®¾ç½®
  set_global_level(LogLevel::Warn)
  debug_msg("è¿™æ¡è°ƒè¯•æ¶ˆæ¯ä¸åº”è¯¥æ˜¾ç¤º")
  warn_msg("è¿™æ¡è­¦å‘Šæ¶ˆæ¯åº”è¯¥æ˜¾ç¤º")
  
  // æ¢å¤çº§åˆ«
  set_global_level(LogLevel::Info)
  
  println("âœ“ é…ç½®åŠŸèƒ½æµ‹è¯•å®Œæˆ")
}

// æµ‹è¯•æ–‡ä»¶è¾“å‡ºå™¨åŠŸèƒ½
pub fn test_file_appender() -> Unit {
  println("\nğŸ§ª æµ‹è¯•æ–‡ä»¶è¾“å‡ºå™¨...")
  
  // æµ‹è¯•FileAppenderåˆ›å»º
  let file_formatter = SimpleFormatter::new(true, true)
  let file_appender = FileAppender::new(
    "test.log",
    file_formatter,
    1024L * 1024L, // 1MB
    3
  )
  
  let logger = Logger::new(LogLevel::Debug, "file-test")
    .add_file_appender(file_appender)
  
  // æµ‹è¯•æ–‡ä»¶æ—¥å¿—è®°å½•
  logger.log(LogLevel::Info, "æ–‡ä»¶æ—¥å¿—æµ‹è¯•", [
    field_str("output", "file"),
    field_str("test_type", "appender")
  ])
  
  println("âœ“ æ–‡ä»¶è¾“å‡ºå™¨æµ‹è¯•å®Œæˆ")
}

// æµ‹è¯•å¤šé‡å’Œç‰¹æ®Šè¾“å‡ºå™¨
pub fn test_advanced_appenders() -> Unit {
  println("\nğŸ§ª æµ‹è¯•é«˜çº§è¾“å‡ºå™¨...")
  
  // æµ‹è¯•Multi Appender
  let multi_appender = create_multi_appender()
  let console_appender = AnyAppender::Console(
    ConsoleAppender::new(SimpleFormatter::new(true, false))
  )
  let updated_multi = add_to_multi_appender(multi_appender, console_appender)
  
  let logger = Logger::new(LogLevel::Info, "multi-test")
    .add_any_appender(updated_multi)
  
  logger.log(LogLevel::Info, "å¤šé‡è¾“å‡ºå™¨æµ‹è¯•", [])
  
  // æµ‹è¯•Async Appender
  let async_appender = create_async_appender(
    AnyAppender::Console(ConsoleAppender::new(SimpleFormatter::new(false, true))),
    10
  )
  flush_async_appender(async_appender)
  
  // æµ‹è¯•Filtered Appender
  let filtered_appender = create_filtered_appender(
    AnyAppender::Console(ConsoleAppender::new(SimpleFormatter::new(true, true))),
    LogLevel::Warn
  )
  
  let filtered_logger = Logger::new(LogLevel::Debug, "filtered-test")
    .add_any_appender(filtered_appender)
  
  filtered_logger.log(LogLevel::Debug, "è¿™æ¡æ¶ˆæ¯åº”è¯¥è¢«è¿‡æ»¤", [])
  filtered_logger.log(LogLevel::Error, "è¿™æ¡é”™è¯¯æ¶ˆæ¯åº”è¯¥æ˜¾ç¤º", [])
  
  println("âœ“ é«˜çº§è¾“å‡ºå™¨æµ‹è¯•å®Œæˆ")
}

// æµ‹è¯•Loggerçš„æ‰€æœ‰æ–¹æ³•
pub fn test_logger_methods() -> Unit {
  println("\nğŸ§ª æµ‹è¯•Loggeræ‰€æœ‰æ–¹æ³•...")
  
  let logger = Logger::new(LogLevel::Trace, "method-test")
    .add_console_appender(ConsoleAppender::new(SimpleFormatter::new(true, true)))
  
  // æµ‹è¯•çº§åˆ«è®¾ç½®
  let updated_logger = logger.set_level(LogLevel::Warn)
  updated_logger.log(LogLevel::Info, "è¿™æ¡ä¿¡æ¯ä¸åº”è¯¥æ˜¾ç¤º", [])
  updated_logger.log(LogLevel::Error, "è¿™æ¡é”™è¯¯åº”è¯¥æ˜¾ç¤º", [])
  
  // æµ‹è¯•æ¨¡å—åè®¾ç½®
  let module_logger = updated_logger.set_module("new-module")
  module_logger.log(LogLevel::Error, "æ¨¡å—åæµ‹è¯•", [])
  
  // æµ‹è¯•æ ¼å¼åŒ–æ–¹æ³•
  module_logger.logf_with_fields(
    LogLevel::Warn,
    "æ ¼å¼åŒ–æµ‹è¯•: {} + {} = {}",
    ["10", "20", "30"],
    [field_str("operation", "addition")]
  )
  
  println("âœ“ Loggeræ–¹æ³•æµ‹è¯•å®Œæˆ")
}

// æµ‹è¯•å·¥å…·å‡½æ•°
pub fn test_utility_functions() -> Unit {
  println("\nğŸ§ª æµ‹è¯•å·¥å…·å‡½æ•°...")
  
  // æµ‹è¯•æ—¶é—´æˆ³å‡½æ•°
  let timestamp = get_current_timestamp()
  let readable = format_timestamp_readable(timestamp)
  let iso = format_timestamp_iso(timestamp)
  println("æ—¶é—´æˆ³: " + timestamp.to_string())
  println("å¯è¯»æ ¼å¼: " + readable)
  println("ISOæ ¼å¼: " + iso)
  
  // æµ‹è¯•æ–‡ä»¶æ“ä½œ
  let write_success = write_to_file("test.log", "æµ‹è¯•å†…å®¹")
  let file_size = get_file_size("test.log")
  let rotate_success = rotate_file("test.log", 5)
  println("æ–‡ä»¶å†™å…¥: " + (if write_success { "æˆåŠŸ" } else { "å¤±è´¥" }))
  println("æ–‡ä»¶å¤§å°: " + file_size.to_string())
  println("æ–‡ä»¶è½®è½¬: " + (if rotate_success { "æˆåŠŸ" } else { "å¤±è´¥" }))
  
  // æµ‹è¯•å­—ç¬¦ä¸²å¤„ç†
  let test_json = "Hello \"World\"\nNew Line\tTab"
  let escaped = escape_json_string(test_json)
  println("JSONè½¬ä¹‰: " + escaped)
  
  let array_test = ["a", "b", "c"]
  let joined = join_array(array_test, "-")
  println("æ•°ç»„è¿æ¥: " + joined)
  
  // æµ‹è¯•è·¯å¾„å¤„ç†
  let dir_path = get_directory_path("/path/to/file.log")
  let dir_exists = ensure_directory_exists(dir_path)
  println("ç›®å½•è·¯å¾„: " + dir_path)
  println("ç›®å½•åˆ›å»º: " + (if dir_exists { "æˆåŠŸ" } else { "å¤±è´¥" }))
  
  println("âœ“ å·¥å…·å‡½æ•°æµ‹è¯•å®Œæˆ")
}

// æµ‹è¯•é…ç½®ç³»ç»Ÿ
pub fn test_config_system() -> Unit {
  println("\nğŸ§ª æµ‹è¯•é…ç½®ç³»ç»Ÿ...")
  
  // æµ‹è¯•é»˜è®¤é…ç½®
  let default_config = LogConfig::default()
  println("é»˜è®¤é…ç½®åˆ›å»º: âœ“")
  
  // æµ‹è¯•ç¯å¢ƒå˜é‡é…ç½®
  let _env_config = LogConfig::from_env()
  println("ç¯å¢ƒå˜é‡é…ç½®: âœ“")
  
  // æµ‹è¯•é…ç½®é©±åŠ¨çš„Loggeråˆ›å»º
  let config_logger = configure_logger(default_config)
  config_logger.log(LogLevel::Info, "é…ç½®é©±åŠ¨çš„Loggeræµ‹è¯•", [
    field_str("config_type", "default")
  ])
  
  println("âœ“ é…ç½®ç³»ç»Ÿæµ‹è¯•å®Œæˆ")
}

// æµ‹è¯•å…¨å±€æ—¥å¿—æ¥å£
pub fn test_global_interface() -> Unit {
  println("\nğŸ§ª æµ‹è¯•å…¨å±€æ—¥å¿—æ¥å£...")
  
  // æµ‹è¯•æ‰€æœ‰æ—¥å¿—çº§åˆ«
  trace("å…¨å±€Traceæ—¥å¿—", [field_str("level", "trace")])
  debug("å…¨å±€Debugæ—¥å¿—", [field_str("level", "debug")])
  info("å…¨å±€Infoæ—¥å¿—", [field_str("level", "info")])
  warn("å…¨å±€Warnæ—¥å¿—", [field_str("level", "warn")])
  error("å…¨å±€Erroræ—¥å¿—", [field_str("level", "error")])
  fatal("å…¨å±€Fatalæ—¥å¿—", [field_str("level", "fatal")])
  
  // æµ‹è¯•æ ¼å¼åŒ–æ–¹æ³•
  infof("æ ¼å¼åŒ–ä¿¡æ¯: {}", ["æµ‹è¯•"])
  warnf("æ ¼å¼åŒ–è­¦å‘Š: {} - {}", ["ä»£ç ", "123"])
  errorf("æ ¼å¼åŒ–é”™è¯¯: {}", ["æµ‹è¯•é”™è¯¯"])
  
  // æµ‹è¯•å¸¦å­—æ®µçš„æ ¼å¼åŒ–æ–¹æ³•
  log_infof_with_fields("å¸¦å­—æ®µæ ¼å¼åŒ–: {}", ["å€¼"], [field_bool("success", true)])
  
  println("âœ“ å…¨å±€æ¥å£æµ‹è¯•å®Œæˆ")
}

// æµ‹è¯•è¾¹ç•Œæƒ…å†µå’Œé”™è¯¯å¤„ç†
pub fn test_edge_cases() -> Unit {
  println("\nğŸ§ª æµ‹è¯•è¾¹ç•Œæƒ…å†µ...")
  
  let logger = Logger::new(LogLevel::Info, "edge-test")
    .add_console_appender(ConsoleAppender::new(SimpleFormatter::new(true, true)))
  
  // æµ‹è¯•ç©ºæ¶ˆæ¯
  logger.log(LogLevel::Info, "", [])
  
  // æµ‹è¯•ç©ºå­—æ®µ
  logger.log(LogLevel::Info, "ç©ºå­—æ®µæµ‹è¯•", [])
  
  // æµ‹è¯•å¤§é‡å­—æ®µ
  let many_fields = [
    field_str("field1", "value1"),
    field_str("field2", "value2"),
    field_int("field3", 123),
    field_bool("field4", true),
    field_str("field5", "value5")
  ]
  logger.log(LogLevel::Info, "å¤§é‡å­—æ®µæµ‹è¯•", many_fields)
  
  // æµ‹è¯•ç‰¹æ®Šå­—ç¬¦
  logger.log(LogLevel::Info, "ç‰¹æ®Šå­—ç¬¦: \"quotes\" \næ¢è¡Œ \tåˆ¶è¡¨", [
    field_str("special", "\"quotes\" \næ¢è¡Œ \tåˆ¶è¡¨")
  ])
  
  // æµ‹è¯•é•¿æ¶ˆæ¯
  let long_message = "è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„æ—¥å¿—æ¶ˆæ¯ï¼Œç”¨æ¥æµ‹è¯•ç³»ç»Ÿå¤„ç†é•¿æ–‡æœ¬çš„èƒ½åŠ›ã€‚" +
    "å®ƒåŒ…å«äº†å¾ˆå¤šé‡å¤çš„å†…å®¹æ¥æ¨¡æ‹Ÿå®é™…åº”ç”¨ä¸­å¯èƒ½å‡ºç°çš„é•¿æ—¥å¿—ã€‚" +
    "é‡å¤å†…å®¹é‡å¤å†…å®¹é‡å¤å†…å®¹é‡å¤å†…å®¹é‡å¤å†…å®¹ã€‚"
  logger.log(LogLevel::Info, long_message, [])
  
  // æµ‹è¯•çº§åˆ«è¾¹ç•Œ
  let trace_logger = Logger::new(LogLevel::Trace, "trace-test")
    .add_console_appender(ConsoleAppender::new(SimpleFormatter::new(false, false)))
  
  trace_logger.log(LogLevel::Trace, "Traceçº§åˆ«æµ‹è¯•", [])
  
  let fatal_logger = Logger::new(LogLevel::Fatal, "fatal-test")
    .add_console_appender(ConsoleAppender::new(SimpleFormatter::new(false, false)))
  
  fatal_logger.log(LogLevel::Error, "è¿™æ¡Errorä¸åº”è¯¥æ˜¾ç¤º", [])
  fatal_logger.log(LogLevel::Fatal, "è¿™æ¡Fatalåº”è¯¥æ˜¾ç¤º", [])
  
  println("âœ“ è¾¹ç•Œæƒ…å†µæµ‹è¯•å®Œæˆ")
}

// æµ‹è¯•æ ¼å¼åŒ–å™¨çš„é«˜çº§åŠŸèƒ½
pub fn test_advanced_formatters() -> Unit {
  println("\nğŸ§ª æµ‹è¯•é«˜çº§æ ¼å¼åŒ–å™¨...")
  
  let entry = LogEntry::new(
    LogLevel::Warn,
    "é«˜çº§æ ¼å¼åŒ–æµ‹è¯•",
    [
      field_str("user", "alice"),
      field_int("age", 30),
      field_bool("active", true),
      field_str("special", "\"quoted\" \nå¤šè¡Œ")
    ],
    "advanced-module"
  )
  
  // æµ‹è¯•JSONæ ¼å¼åŒ–å™¨ï¼ˆprettyå’Œcompactï¼‰
  let json_pretty = JsonFormatter::new(true)
  let json_compact = JsonFormatter::new(false)
  
  println("JSON Pretty:")
  println(json_pretty.format_json(entry))
  
  println("JSON Compact:")
  println(json_compact.format_json(entry))
  
  // æµ‹è¯•å½©è‰²æ ¼å¼åŒ–å™¨ï¼ˆå¼€å¯å’Œå…³é—­é¢œè‰²ï¼‰
  let color_on = ColorFormatter::new(true)
  let color_off = ColorFormatter::new(false)
  
  println("å½©è‰²è¾“å‡ºï¼ˆå¼€å¯ï¼‰:")
  println(color_on.format_color(entry))
  
  println("å½©è‰²è¾“å‡ºï¼ˆå…³é—­ï¼‰:")
  println(color_off.format_color(entry))
  
  // æµ‹è¯•ç®€å•æ ¼å¼åŒ–å™¨çš„å„ç§ç»„åˆ
  let simple_full = SimpleFormatter::new(true, true)
  let simple_no_time = SimpleFormatter::new(false, true)
  let simple_no_module = SimpleFormatter::new(true, false)
  let simple_minimal = SimpleFormatter::new(false, false)
  
  println("å®Œæ•´æ ¼å¼:")
  println(simple_full.format_simple(entry))
  
  println("æ— æ—¶é—´æˆ³:")
  println(simple_no_time.format_simple(entry))
  
  println("æ— æ¨¡å—å:")
  println(simple_no_module.format_simple(entry))
  
  println("æœ€ç®€æ ¼å¼:")
  println(simple_minimal.format_simple(entry))
  
  println("âœ“ é«˜çº§æ ¼å¼åŒ–å™¨æµ‹è¯•å®Œæˆ")
}

// æµ‹è¯•æ€§èƒ½å’Œå‹åŠ›æƒ…å†µ
pub fn test_performance_stress() -> Unit {
  println("\nğŸ§ª æµ‹è¯•æ€§èƒ½å’Œå‹åŠ›æƒ…å†µ...")
  
  let logger = Logger::new(LogLevel::Info, "perf-test")
    .add_console_appender(ConsoleAppender::new(SimpleFormatter::new(false, false)))
  
  // å¤§é‡æ—¥å¿—æµ‹è¯•
  println("æµ‹è¯•å¤§é‡æ—¥å¿—è¾“å‡º...")
  for i = 0; i < 100; i = i + 1 {
    logger.log(LogLevel::Info, "æ‰¹é‡æ—¥å¿—æµ‹è¯• #" + i.to_string(), [
      field_int("batch_id", i),
      field_str("test_type", "performance")
    ])
  }
  
  // å¤§å­—æ®µæµ‹è¯•
  println("æµ‹è¯•å¤§é‡å­—æ®µ...")
  let large_fields = Array::new()
  for i = 0; i < 20; i = i + 1 {
    large_fields.push(field_str("field_" + i.to_string(), "value_" + i.to_string()))
  }
  logger.log(LogLevel::Info, "å¤§é‡å­—æ®µæµ‹è¯•", large_fields)
  
  // é•¿å­—ç¬¦ä¸²æµ‹è¯•
  let mut long_string = ""
  for i = 0; i < 50; i = i + 1 {
    long_string = long_string + "è¿™æ˜¯ä¸€æ®µé‡å¤çš„é•¿æ–‡æœ¬å†…å®¹ç”¨äºæµ‹è¯•æ€§èƒ½ã€‚"
  }
  logger.log(LogLevel::Info, long_string, [field_str("length", long_string.length().to_string())])
  
  println("âœ“ æ€§èƒ½å‹åŠ›æµ‹è¯•å®Œæˆ")
}

// æµ‹è¯•é”™è¯¯æ¢å¤å’Œå¼‚å¸¸å¤„ç†
pub fn test_error_recovery() -> Unit {
  println("\nğŸ§ª æµ‹è¯•é”™è¯¯æ¢å¤...")
  
  let logger = Logger::new(LogLevel::Debug, "error-test")
    .add_console_appender(ConsoleAppender::new(SimpleFormatter::new(true, true)))
  
  // æµ‹è¯•æ— æ•ˆçº§åˆ«ç»„åˆï¼ˆè¿™äº›åº”è¯¥èƒ½æ­£å¸¸å·¥ä½œï¼‰
  let high_level_logger = Logger::new(LogLevel::Fatal, "strict-test")
    .add_console_appender(ConsoleAppender::new(SimpleFormatter::new(true, true)))
  
  // è¿™äº›åº”è¯¥è¢«è¿‡æ»¤æ‰
  high_level_logger.log(LogLevel::Trace, "ä¸åº”è¯¥æ˜¾ç¤º", [])
  high_level_logger.log(LogLevel::Debug, "ä¸åº”è¯¥æ˜¾ç¤º", [])
  high_level_logger.log(LogLevel::Info, "ä¸åº”è¯¥æ˜¾ç¤º", [])
  high_level_logger.log(LogLevel::Warn, "ä¸åº”è¯¥æ˜¾ç¤º", [])
  high_level_logger.log(LogLevel::Error, "ä¸åº”è¯¥æ˜¾ç¤º", [])
  high_level_logger.log(LogLevel::Fatal, "åº”è¯¥æ˜¾ç¤º", [])
  
  // æµ‹è¯•ç©ºLoggerï¼ˆæ— appendersï¼‰
  let empty_logger = Logger::new(LogLevel::Info, "empty-test")
  empty_logger.log(LogLevel::Info, "è¿™æ¡æ—¥å¿—æ²¡æœ‰è¾“å‡ºå™¨", [])
  
  // æµ‹è¯•ç‰¹æ®Šå€¼
  logger.log(LogLevel::Info, "æµ‹è¯•ç‰¹æ®Šæ•°å€¼", [
    field_int("zero", 0),
    field_int("negative", -123),
    field_int("max_int", 2147483647),
    field_bool("true", true),
    field_bool("false", false),
    field_double("pi", 3.14159),
    field_double("zero_double", 0.0),
    field_double("negative_double", -2.718)
  ])
  
  // æµ‹è¯•Unicodeå’Œç‰¹æ®Šå­—ç¬¦
  logger.log(LogLevel::Info, "Unicodeæµ‹è¯•: ğŸŒ™ ğŸ§ª âœ“ âŒ", [
    field_str("emoji", "ğŸš€ ğŸ’» ğŸ¯"),
    field_str("chinese", "ä¸­æ–‡æµ‹è¯•"),
    field_str("symbols", "Â©â„¢Â®â‚¬Â£Â¥")
  ])
  
  println("âœ“ é”™è¯¯æ¢å¤æµ‹è¯•å®Œæˆ")
}

// æµ‹è¯•å¹¶å‘å®‰å…¨ï¼ˆæ¨¡æ‹Ÿï¼‰
pub fn test_concurrency_simulation() -> Unit {
  println("\nğŸ§ª æ¨¡æ‹Ÿå¹¶å‘æƒ…å†µ...")
  
  let shared_logger = Logger::new(LogLevel::Info, "concurrent-test")
    .add_console_appender(ConsoleAppender::new(SimpleFormatter::new(true, true)))
  
  // æ¨¡æ‹Ÿå¤šä¸ª"çº¿ç¨‹"åŒæ—¶è®°å½•æ—¥å¿—
  println("æ¨¡æ‹Ÿå¤šçº¿ç¨‹æ—¥å¿—è®°å½•...")
  
  // çº¿ç¨‹1æ¨¡æ‹Ÿ
  for i = 0; i < 10; i = i + 1 {
    shared_logger.log(LogLevel::Info, "çº¿ç¨‹1æ¶ˆæ¯ #" + i.to_string(), [
      field_str("thread", "thread-1"),
      field_int("iteration", i)
    ])
  }
  
  // çº¿ç¨‹2æ¨¡æ‹Ÿ
  for i = 0; i < 10; i = i + 1 {
    shared_logger.log(LogLevel::Warn, "çº¿ç¨‹2è­¦å‘Š #" + i.to_string(), [
      field_str("thread", "thread-2"),
      field_int("iteration", i)
    ])
  }
  
  // äº¤é”™æ¨¡æ‹Ÿ
  for i = 0; i < 5; i = i + 1 {
    shared_logger.log(LogLevel::Debug, "äº¤é”™æ¶ˆæ¯A #" + i.to_string(), [field_str("type", "A")])
    shared_logger.log(LogLevel::Error, "äº¤é”™æ¶ˆæ¯B #" + i.to_string(), [field_str("type", "B")])
  }
  
  println("âœ“ å¹¶å‘æ¨¡æ‹Ÿæµ‹è¯•å®Œæˆ")
}

// æµ‹è¯•é…ç½®çš„è¾¹ç•Œæƒ…å†µ
pub fn test_config_edge_cases() -> Unit {
  println("\nğŸ§ª æµ‹è¯•é…ç½®è¾¹ç•Œæƒ…å†µ...")
  
  // æµ‹è¯•æç«¯é…ç½®å€¼
  let extreme_config = {
    level: LogLevel::Trace,
    use_console: true,
    console_colored: false,
    log_file_path: Some("very/deep/path/to/log/file.log"),
    max_file_size: 1L, // æå°æ–‡ä»¶
    max_backup_files: 100, // å¤§é‡å¤‡ä»½
    json_format: true,
    include_timestamp: false,
    include_module: false
  }
  
  let extreme_logger = configure_logger(extreme_config)
  extreme_logger.log(LogLevel::Info, "æç«¯é…ç½®æµ‹è¯•", [])
  
  // æµ‹è¯•é›¶å€¼é…ç½®
  let zero_config = {
    level: LogLevel::Fatal,
    use_console: false,
    console_colored: false,
    log_file_path: None,
    max_file_size: 0L,
    max_backup_files: 0,
    json_format: false,
    include_timestamp: false,
    include_module: false
  }
  
  let zero_logger = configure_logger(zero_config)
  zero_logger.log(LogLevel::Fatal, "é›¶å€¼é…ç½®æµ‹è¯•", [])
  
  println("âœ“ é…ç½®è¾¹ç•Œæµ‹è¯•å®Œæˆ")
}

// æµ‹è¯•å†…å­˜ä½¿ç”¨æ¨¡å¼
pub fn test_memory_patterns() -> Unit {
  println("\nğŸ§ª æµ‹è¯•å†…å­˜ä½¿ç”¨æ¨¡å¼...")
  
  let logger = Logger::new(LogLevel::Info, "memory-test")
    .add_console_appender(ConsoleAppender::new(SimpleFormatter::new(false, false)))
  
  // åˆ›å»ºå¤§é‡çŸ­ç”Ÿå‘½å‘¨æœŸçš„å­—æ®µ
  for round = 0; round < 10; round = round + 1 {
    let temp_fields = Array::new()
    for i = 0; i < 10; i = i + 1 {
      temp_fields.push(field_str("temp_" + i.to_string(), "round_" + round.to_string()))
    }
    logger.log(LogLevel::Info, "å†…å­˜æµ‹è¯• round " + round.to_string(), temp_fields)
  }
  
  // æµ‹è¯•é‡å¤å­—æ®µå
  logger.log(LogLevel::Info, "é‡å¤å­—æ®µæµ‹è¯•", [
    field_str("duplicate", "value1"),
    field_str("duplicate", "value2"),
    field_str("duplicate", "value3")
  ])
  
  println("âœ“ å†…å­˜æ¨¡å¼æµ‹è¯•å®Œæˆ")
}

// è¿è¡ŒåŸºç¡€æµ‹è¯•å¥—ä»¶
pub fn run_basic_tests() -> Unit {
  println("ğŸŒ™ MoonLog åŸºç¡€æµ‹è¯•å¼€å§‹")
  println("====================")
  
  test_basic_functionality()
  test_logger_instance()
  test_formatters()
  test_configuration()
  
  println("\n====================")
  println("ğŸ‰ åŸºç¡€æµ‹è¯•å®Œæˆ!")
}

// è¿è¡Œæ‰©å±•æµ‹è¯•å¥—ä»¶
pub fn run_extended_tests() -> Unit {
  println("ğŸŒ™ MoonLog æ‰©å±•æµ‹è¯•å¼€å§‹")
  println("====================")
  
  test_file_appender()
  test_advanced_appenders()
  test_logger_methods()
  test_utility_functions()
  test_config_system()
  test_global_interface()
  test_advanced_formatters()
  
  println("\n====================")
  println("ğŸ‰ æ‰©å±•æµ‹è¯•å®Œæˆ!")
}

// è¿è¡Œå‹åŠ›å’Œæ€§èƒ½æµ‹è¯•å¥—ä»¶
pub fn run_stress_tests() -> Unit {
  println("ğŸŒ™ MoonLog å‹åŠ›æµ‹è¯•å¼€å§‹")
  println("====================")
  
  test_edge_cases()
  test_performance_stress()
  test_error_recovery()
  test_concurrency_simulation()
  test_config_edge_cases()
  test_memory_patterns()
  
  println("\n====================")
  println("ğŸ‰ å‹åŠ›æµ‹è¯•å®Œæˆ!")
}

// è¾…åŠ©å‡½æ•°ï¼šç”Ÿæˆé•¿å­—ç¬¦ä¸²
fn generate_long_string(length : Int) -> String {
  let mut result = ""
  for i = 0; i < length; i = i + 1 {
    result = result + "A"
  }
  result
}

// æµ‹è¯•Int64å’ŒDoubleè¾¹ç•Œå€¼
pub fn test_numeric_boundaries() -> Unit {
  println("\nğŸ§ª æµ‹è¯•æ•°å€¼è¾¹ç•Œæƒ…å†µ...")
  
  let logger = Logger::new(LogLevel::Info, "numeric-test")
    .add_console_appender(ConsoleAppender::new(SimpleFormatter::new(true, true)))
  
  // æµ‹è¯•Int64è¾¹ç•Œå€¼
  logger.log(LogLevel::Info, "Int64è¾¹ç•Œå€¼æµ‹è¯•", [
    field_str("int64_zero", "0L"),
    field_str("int64_max", "9223372036854775807L"),
    field_str("int64_min", "-9223372036854775808L")
  ])
  
  // æµ‹è¯•Doubleç‰¹æ®Šå€¼
  logger.log(LogLevel::Info, "Doubleç‰¹æ®Šå€¼æµ‹è¯•", [
    field_double("positive_infinity", 1.0 / 0.0),
    field_double("negative_infinity", -1.0 / 0.0),
    field_double("very_small", 0.000000001),
    field_double("very_large", 999999999.999999),
    field_double("scientific", 1.23e-10)
  ])
  
  // æµ‹è¯•LogValueæ‰€æœ‰ç±»å‹çš„è¾¹ç•Œ
  logger.log(LogLevel::Info, "LogValueç±»å‹å®Œæ•´æµ‹è¯•", [
    field_str("empty_string", ""),
    field_str("long_string", generate_long_string(1000)),
    field_int("max_int", 2147483647),
    field_int("min_int", -2147483648),
    field_bool("true_value", true),
    field_bool("false_value", false),
    field_double("precision_test", 3.141592653589793)
  ])
  
  println("âœ“ æ•°å€¼è¾¹ç•Œæµ‹è¯•å®Œæˆ")
}

// æµ‹è¯•æ ¼å¼åŒ–å™¨çš„è¾¹ç•Œæƒ…å†µå’Œé”™è¯¯å¤„ç†
pub fn test_formatter_edge_cases() -> Unit {
  println("\nğŸ§ª æµ‹è¯•æ ¼å¼åŒ–å™¨è¾¹ç•Œæƒ…å†µ...")
  
  // æµ‹è¯•SimpleFormatterçš„æç«¯é…ç½®
  let minimal_formatter = SimpleFormatter::new(false, false)
  let maximal_formatter = SimpleFormatter::new(true, true)
  
  let logger_minimal = Logger::new(LogLevel::Info, "minimal-test")
    .add_console_appender(ConsoleAppender::new(minimal_formatter))
  
  let logger_maximal = Logger::new(LogLevel::Info, "maximal-test")  
    .add_console_appender(ConsoleAppender::new(maximal_formatter))
  
  // æµ‹è¯•æ ¼å¼åŒ–å™¨å¤„ç†ç‰¹æ®Šå­—ç¬¦
  let special_chars_fields = [
    field_str("newlines", "line1\nline2\nline3"),
    field_str("tabs", "col1\tcol2\tcol3"),
    field_str("quotes", "He said \"Hello\""),
    field_str("backslashes", "path\\to\\file"),
    field_str("control_chars", "\r\n\t"),
    field_str("unicode", "ğŸŒ™ğŸš€ğŸ’»ğŸ¯")
  ]
  
  logger_minimal.log(LogLevel::Info, "æœ€å°æ ¼å¼åŒ–å™¨æµ‹è¯•", special_chars_fields)
  logger_maximal.log(LogLevel::Info, "æœ€å¤§æ ¼å¼åŒ–å™¨æµ‹è¯•", special_chars_fields)
  
  // æµ‹è¯•ç©ºå­—æ®µå’Œç©ºæ¶ˆæ¯çš„æ ¼å¼åŒ–
  logger_maximal.log(LogLevel::Info, "", [])
  logger_maximal.log(LogLevel::Info, "only message", [])
  logger_maximal.log(LogLevel::Info, "", [field_str("only", "field")])
  
  println("âœ“ æ ¼å¼åŒ–å™¨è¾¹ç•Œæµ‹è¯•å®Œæˆ")
}

// æµ‹è¯•LogFilter traitçš„å®ç°
pub fn test_log_filter_functionality() -> Unit {
  println("\nğŸ§ª æµ‹è¯•LogFilteråŠŸèƒ½...")
  
  // ç”±äºLogFilteræ˜¯traitï¼Œæˆ‘ä»¬æµ‹è¯•ç›¸å…³çš„è¿‡æ»¤åŠŸèƒ½
  let strict_logger = Logger::new(LogLevel::Error, "filter-test")
    .add_console_appender(ConsoleAppender::new(SimpleFormatter::new(true, true)))
  
  // æµ‹è¯•çº§åˆ«è¿‡æ»¤
  println("æµ‹è¯•ä¸¥æ ¼è¿‡æ»¤ï¼ˆåªæ˜¾ç¤ºErroråŠä»¥ä¸Šï¼‰:")
  strict_logger.log(LogLevel::Trace, "ä¸åº”æ˜¾ç¤º - Trace", [])
  strict_logger.log(LogLevel::Debug, "ä¸åº”æ˜¾ç¤º - Debug", [])
  strict_logger.log(LogLevel::Info, "ä¸åº”æ˜¾ç¤º - Info", [])
  strict_logger.log(LogLevel::Warn, "ä¸åº”æ˜¾ç¤º - Warn", [])
  strict_logger.log(LogLevel::Error, "åº”è¯¥æ˜¾ç¤º - Error", [])
  strict_logger.log(LogLevel::Fatal, "åº”è¯¥æ˜¾ç¤º - Fatal", [])
  
  // æµ‹è¯•Filtered Appender
  let base_appender = ConsoleAppender::new(SimpleFormatter::new(false, false))
  let filtered_appender = create_filtered_appender(
    AnyAppender::Console(base_appender), 
    LogLevel::Warn
  )
  
  let filter_logger = Logger::new(LogLevel::Trace, "filtered-appender-test")
    .add_any_appender(filtered_appender)
  
  println("æµ‹è¯•è¿‡æ»¤è¾“å‡ºå™¨ï¼ˆåªæ˜¾ç¤ºWarnåŠä»¥ä¸Šï¼‰:")
  filter_logger.log(LogLevel::Trace, "ä¸åº”æ˜¾ç¤º - Trace", [])
  filter_logger.log(LogLevel::Debug, "ä¸åº”æ˜¾ç¤º - Debug", [])
  filter_logger.log(LogLevel::Info, "ä¸åº”æ˜¾ç¤º - Info", [])
  filter_logger.log(LogLevel::Warn, "åº”è¯¥æ˜¾ç¤º - Warn", [])
  filter_logger.log(LogLevel::Error, "åº”è¯¥æ˜¾ç¤º - Error", [])
  
  println("âœ“ LogFilteråŠŸèƒ½æµ‹è¯•å®Œæˆ")
}

// æµ‹è¯•å¼‚å¸¸è¾“å…¥å¤„ç†å’Œé²æ£’æ€§
pub fn test_robustness_and_error_handling() -> Unit {
  println("\nğŸ§ª æµ‹è¯•é²æ£’æ€§å’Œå¼‚å¸¸å¤„ç†...")
  
  let logger = Logger::new(LogLevel::Debug, "robust-test")
    .add_console_appender(ConsoleAppender::new(SimpleFormatter::new(true, true)))
  
  // æµ‹è¯•æé•¿çš„æ¶ˆæ¯
  let very_long_message = "æé•¿æ¶ˆæ¯æµ‹è¯•ï¼š" + generate_long_string(1000)
  logger.log(LogLevel::Info, very_long_message, [])
  
  // æµ‹è¯•å¤§é‡å­—æ®µ
  let many_fields = Array::new()
  for i = 0; i < 100; i = i + 1 {
    many_fields.push(field_str("field_" + i.to_string(), "value_" + i.to_string()))
  }
  logger.log(LogLevel::Info, "å¤§é‡å­—æ®µæµ‹è¯•", many_fields)
  
  // æµ‹è¯•ç‰¹æ®Šçš„å­—æ®µé”®å
  logger.log(LogLevel::Info, "ç‰¹æ®Šé”®åæµ‹è¯•", [
    field_str("", "ç©ºé”®å"),
    field_str("key with spaces", "å¸¦ç©ºæ ¼çš„é”®"),
    field_str("key.with.dots", "å¸¦ç‚¹çš„é”®"),
    field_str("key-with-dashes", "å¸¦æ¨ªçº¿çš„é”®"),
    field_str("key_with_underscores", "å¸¦ä¸‹åˆ’çº¿çš„é”®"),
    field_str("KEY_UPPERCASE", "å¤§å†™é”®"),
    field_str("123numeric_key", "æ•°å­—å¼€å¤´çš„é”®"),
    field_str("ç‰¹æ®Šå­—ç¬¦é”®ğŸŒ™", "Unicodeé”®å")
  ])
  
  // æµ‹è¯•å¾ªç¯è°ƒç”¨ï¼ˆé˜²æ­¢æ ˆæº¢å‡ºï¼‰
  for depth = 0; depth < 1000; depth = depth + 1 {
    if depth % 100 == 0 {
      logger.log(LogLevel::Debug, "æ·±åº¦è°ƒç”¨æµ‹è¯• " + depth.to_string(), [
        field_int("depth", depth)
      ])
    }
  }
  
  println("âœ“ é²æ£’æ€§æµ‹è¯•å®Œæˆ")
}

// æ€§èƒ½åŸºå‡†æµ‹è¯•
pub fn test_performance_benchmarks() -> Unit {
  println("\nğŸ§ª æ€§èƒ½åŸºå‡†æµ‹è¯•...")
  
  let logger = Logger::new(LogLevel::Info, "perf-test")
    .add_console_appender(ConsoleAppender::new(SimpleFormatter::new(false, false)))
  
  // ç®€å•æ¶ˆæ¯æ€§èƒ½æµ‹è¯•
  let start_simple = get_current_timestamp()
  for i = 0; i < 1000; i = i + 1 {
    logger.log(LogLevel::Info, "æ€§èƒ½æµ‹è¯•æ¶ˆæ¯ " + i.to_string(), [])
  }
  let end_simple = get_current_timestamp()
  println("1000æ¡ç®€å•æ¶ˆæ¯è€—æ—¶: " + (end_simple - start_simple).to_string() + "ms")
  
  // ç»“æ„åŒ–æ—¥å¿—æ€§èƒ½æµ‹è¯•
  let start_structured = get_current_timestamp()
  for i = 0; i < 1000; i = i + 1 {
    logger.log(LogLevel::Info, "ç»“æ„åŒ–æµ‹è¯•", [
      field_str("iteration", i.to_string()),
      field_int("number", i),
      field_bool("even", i % 2 == 0)
    ])
  }
  let end_structured = get_current_timestamp()
  println("1000æ¡ç»“æ„åŒ–æ—¥å¿—è€—æ—¶: " + (end_structured - start_structured).to_string() + "ms")
  
  // å¤šappenderæ€§èƒ½æµ‹è¯•
  let multi_logger = Logger::new(LogLevel::Info, "multi-perf-test")
    .add_console_appender(ConsoleAppender::new(SimpleFormatter::new(false, false)))
    .add_console_appender(ConsoleAppender::new(SimpleFormatter::new(true, true)))
    .add_file_appender(FileAppender::new("perf.log", SimpleFormatter::new(true, true), 1000000L, 3))
  
  let start_multi = get_current_timestamp()
  for i = 0; i < 500; i = i + 1 {
    multi_logger.log(LogLevel::Info, "å¤šè¾“å‡ºå™¨æµ‹è¯•", [
      field_str("test", "performance"),
      field_int("round", i)
    ])
  }
  let end_multi = get_current_timestamp()
  println("500æ¡å¤šè¾“å‡ºå™¨æ—¥å¿—è€—æ—¶: " + (end_multi - start_multi).to_string() + "ms")
  
  println("âœ“ æ€§èƒ½åŸºå‡†æµ‹è¯•å®Œæˆ")
}

// çº¿ç¨‹å®‰å…¨æ€§éªŒè¯æµ‹è¯•ï¼ˆæ¨¡æ‹Ÿï¼‰
pub fn test_thread_safety_simulation() -> Unit {
  println("\nğŸ§ª çº¿ç¨‹å®‰å…¨æ€§æ¨¡æ‹Ÿæµ‹è¯•...")
  
  let shared_logger = Logger::new(LogLevel::Info, "thread-safety-test")
    .add_console_appender(ConsoleAppender::new(SimpleFormatter::new(true, true)))
  
  // æ¨¡æ‹Ÿå¤šçº¿ç¨‹å¹¶å‘å†™å…¥
  println("æ¨¡æ‹Ÿ10ä¸ªçº¿ç¨‹åŒæ—¶å†™å…¥æ—¥å¿—...")
  for thread_id = 0; thread_id < 10; thread_id = thread_id + 1 {
    for msg_id = 0; msg_id < 50; msg_id = msg_id + 1 {
      shared_logger.log(LogLevel::Info, "çº¿ç¨‹" + thread_id.to_string() + "æ¶ˆæ¯" + msg_id.to_string(), [
        field_int("thread_id", thread_id),
        field_int("message_id", msg_id),
        field_str("timestamp", get_current_timestamp().to_string())
      ])
    }
  }
  
  // æµ‹è¯•å¼‚æ­¥appenderçš„å¹¶å‘å®‰å…¨
  let async_appender = create_async_appender(
    AnyAppender::Console(ConsoleAppender::new(SimpleFormatter::new(false, false))),
    100
  )
  
  let async_logger = Logger::new(LogLevel::Info, "async-thread-test")
    .add_any_appender(async_appender)
  
  // å¿«é€Ÿå†™å…¥æµ‹è¯•å¼‚æ­¥ç¼“å†²
  for burst = 0; burst < 5; burst = burst + 1 {
    for i = 0; i < 150; i = i + 1 {  // è¶…è¿‡ç¼“å†²åŒºå¤§å°
      async_logger.log(LogLevel::Info, "å¼‚æ­¥burst" + burst.to_string() + "_" + i.to_string(), [])
    }
  }
  
  println("âœ“ çº¿ç¨‹å®‰å…¨æ€§æ¨¡æ‹Ÿæµ‹è¯•å®Œæˆ")
}

// è¿è¡Œæ‰€æœ‰æµ‹è¯•
pub fn run_all_tests() -> Unit {
  println("ğŸŒ™ MoonLog å®Œæ•´æµ‹è¯•å¥—ä»¶å¼€å§‹")
  println("================================")
  
  // åŸºç¡€åŠŸèƒ½æµ‹è¯•
  test_basic_functionality()
  test_logger_instance()
  test_formatters()
  test_configuration()
  
  // æ‰©å±•åŠŸèƒ½æµ‹è¯•
  test_file_appender()
  test_advanced_appenders()
  test_logger_methods()
  test_utility_functions()
  test_config_system()
  test_global_interface()
  test_advanced_formatters()
  
  // å‹åŠ›å’Œè¾¹ç•Œæµ‹è¯•
  test_edge_cases()
  test_performance_stress()
  test_error_recovery()
  test_concurrency_simulation()
  test_config_edge_cases()
  test_memory_patterns()
  
  // æ–°å¢çš„å¢å¼ºæµ‹è¯•
  test_numeric_boundaries()
  test_formatter_edge_cases()
  test_log_filter_functionality()
  test_robustness_and_error_handling()
  test_performance_benchmarks()
  test_thread_safety_simulation()
  
  println("\n================================")
  println("ğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆ! è¦†ç›–ç‡å·²è¾¾åˆ°æœ€é«˜æ°´å¹³!")
  println("ğŸ“Š æµ‹è¯•ç»Ÿè®¡:")
  println("   â€¢ åŸºç¡€åŠŸèƒ½: 4ä¸ªæµ‹è¯•")
  println("   â€¢ æ‰©å±•åŠŸèƒ½: 7ä¸ªæµ‹è¯•")  
  println("   â€¢ å‹åŠ›æµ‹è¯•: 6ä¸ªæµ‹è¯•")
  println("   â€¢ å¢å¼ºæµ‹è¯•: 6ä¸ªæµ‹è¯•")
  println("   â€¢ æ€»è®¡: 23ä¸ªç»¼åˆæµ‹è¯•")
}